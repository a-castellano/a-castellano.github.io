<!doctype html><html lang=en-us><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://a-castellano.github.io/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://a-castellano.github.io/css/github.css><link crossorigin=anonymous media="(prefers-color-scheme: dark)" rel=stylesheet href=https://a-castellano.github.io/css/dark.css><meta name=viewport content="width=device-width"><title>Restrict Linux users to certain workspaces - Álvaro Castellano - Personal Blog</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://a-castellano.github.io/images/favicon.ico><meta name=theme-color content="#1e2327"></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://a-castellano.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://a-castellano.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class=avatar src="https://avatars0.githubusercontent.com/u/11519707?s=460&u=c9ea059a83c4ea6f9daddec4fff28b1afacbe85a&v=4" height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://a-castellano.github.io/about/><img src="https://avatars0.githubusercontent.com/u/11519707?s=460&u=c9ea059a83c4ea6f9daddec4fff28b1afacbe85a&v=4" width=26 height=26></a>
<span class=author><a href=https://a-castellano.github.io/>Álvaro Castellano</a></span>
<span class=path-divider>/</span>
<strong itemprop=name class=css-truncate-target style=max-width:410px><a href=https://a-castellano.github.io/posts/restrict-linux-users-to-certain-workspaces-only/>Restrict Linux users to certain workspaces</a></strong><div class="d-block text-small text-gray">Created <time-ago datetime=2016-09-22 class=no-wrap title="Created at 2016/09/22">2016-09-22</time-ago>
<span class=file-info-divider></span>Modifyed <time-ago datetime=2016-09-22 class=no-wrap title="Modified  at 2016/09/22">2016-09-22</time-ago></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1594 Words</div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><p>In this post I will talk about managing workspace access for certain users in Linux environments. We will set a workspace where some guests will be able to work in their amazing project. These users won&rsquo;t have access to the files outside of their shared workspace. Finally we will use Linux ACL to manage user permissions inside their workspace.</p><p>This post resolves a real issue that I had few days ago. I was asked to restrict access to a couple users in a server. At the time I had no idea how to solve this issue in a smart way.</p><h2 id=problem-overview>Problem overview</h2><p>I need to allow a new user who is developing a new website into our development environment machine.</p><p>Doing this is very easy, we only need to create a user in our server… but here comes the problem, this user would be able to see other users&rsquo; home folders, config folders, etc.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh developerguest1@IP_ADDRES_OF_OUR_TEST_MACHINE
$ cd /home/john/
$ ls
john_files
$ rsync -aP john_files SOMEWHERE
$ cd /etc/apache2/sites-enabled/
</code></pre></div><p><img src=/images/restrict-users-non-restrict.png alt="developerguest1 is able to read the server configurations"></p><p>I don&rsquo;t trust neither <em>developerguest1</em> nor his brother in arms <em>developerguest2</em>.
I want to isolate their workspace from my entire server.
Both developers will be able to work in their work directories but they won&rsquo;t be able to know what is outside those directories.
In this real case both developers will share their workspace but some folders will be owned only by one of them.</p><p>Let&rsquo;s do it!</p><h2 id=setting-up-our-workspace>Setting up our workspace</h2><p>In this post we will use <strong>Vagrant</strong> to deploy our test server, it allows us to deploy development environments in minutes.
We can deploy our environments to multiple providers such as <strong>VirtualBox</strong>, <strong>VMware Fusion</strong> or <strong>AWS</strong>.
See the <a href=https://www.vagrantup.com/docs/>Official documentation</a> for more info.
In my case, I use Vagrant to make quick tests with Virtual Machines before deploying my configurations into production environments.
Of course, you can use any other type of virtual machine or physical machines, as you wish.</p><p>Let&rsquo;s start cloning my <a href=https://github.com/a-castellano/Sysadmin-Scripts>Sysadmin Scripts</a> repo which contains the <strong>Vagrantfile</strong> that we will use.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/a-castellano/Sysadmin-Scripts.git
cd Sysadmin-Scripts/Vagrant/Ubuntu_14
cp bootstrap.sh.example bootstrap.sh
vim bootstrap.sh
</code></pre></div><p>Add your ssh public key in your local copy.</p><pre><code>#!/usr/bin/env bash

#Make a copy of this file called bootstrap-ansible.sh
#Set your ssh key, it would be your master_key.pub
mkdir -p /root/.ssh
echo &quot;YOUR PUBLIC SSH KEY&quot; &gt;&gt; /root/.ssh/authorized_keys
apt-get update -y
apt-get upgrade -y
</code></pre><p>Let&rsquo;s awaken our machine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>⇒  vagrant up
Bringing machine <span style=color:#e6db74>&#39;ubuntu1&#39;</span> up with <span style=color:#e6db74>&#39;virtualbox&#39;</span> provider...
<span style=color:#f92672>==</span>&gt; ubuntu1: Importing base box <span style=color:#e6db74>&#39;ubuntu/trusty64&#39;</span>...
<span style=color:#f92672>==</span>&gt; ubuntu1: Matching MAC address <span style=color:#66d9ef>for</span> NAT networking...
<span style=color:#f92672>==</span>&gt; ubuntu1: Checking <span style=color:#66d9ef>if</span> box <span style=color:#e6db74>&#39;ubuntu/trusty64&#39;</span> is up to date...
<span style=color:#f92672>==</span>&gt; ubuntu1: Setting the name of the VM: Ubuntu_14_ubuntu1_1474577586167_25708
<span style=color:#f92672>==</span>&gt; ubuntu1: Clearing any previously set forwarded ports...
<span style=color:#f92672>==</span>&gt; ubuntu1: Clearing any previously set network interfaces...
<span style=color:#f92672>==</span>&gt; ubuntu1: Available bridged network interfaces:
1<span style=color:#f92672>)</span> en3: Ethernet Thunderbolt
2<span style=color:#f92672>)</span> en0: Wi-Fi <span style=color:#f92672>(</span>AirPort<span style=color:#f92672>)</span>
3<span style=color:#f92672>)</span> en1: Thunderbolt <span style=color:#ae81ff>1</span>
4<span style=color:#f92672>)</span> en2: Thunderbolt <span style=color:#ae81ff>2</span>
5<span style=color:#f92672>)</span> bridge0
6<span style=color:#f92672>)</span> bridge100
<span style=color:#f92672>==</span>&gt; ubuntu1: When choosing an interface, it is usually the one that is
<span style=color:#f92672>==</span>&gt; ubuntu1: being used to connect to the internet.
    ubuntu1: Which interface should the network bridge to? <span style=color:#ae81ff>1</span>
</code></pre></div><p>When Vagrant ends it will show us our new machine IP address, let&rsquo;s write it in our inventory file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd ~/Sysadmin-Scripts/Ansible
vim inventory/my.hosts
</code></pre></div><p>Place your Vagrant IP address in your inventory file.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>testMine<span style=color:#f92672>]</span>
192.168.*.*
</code></pre></div><p>Now, let&rsquo;s create the playbook to setup our environment.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir playbooks/setup_test
vim mkdir playbooks/setup_test/setup.yml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>---

  - <span style=color:#66d9ef>hosts</span>: testMine

    <span style=color:#66d9ef>vars_files</span>:
      - ../../vars/target_hosts/testMine.yml

    <span style=color:#66d9ef>roles</span>:
      - { <span style=color:#66d9ef>role</span>: ../../roles/common_setup }
      - { <span style=color:#66d9ef>role</span>: ../../roles/zsh_setup }
      - { <span style=color:#66d9ef>role</span>: ../../roles/apache_setup }
      - { <span style=color:#66d9ef>role</span>: ../../roles/php_setup }
      - { <span style=color:#66d9ef>role</span>: ../../roles/create_user }
...
</code></pre></div><p>Our playbook needs another file containing the config of our test machine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vim vars/target_hosts/testMine.yml
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>---
  <span style=color:#66d9ef>server_hostname</span>: Test

  <span style=color:#66d9ef>usergroups</span>:
    - developers

  <span style=color:#66d9ef>users</span>:
    - <span style=color:#66d9ef>username</span>: john
      <span style=color:#66d9ef>groups</span>: [<span style=color:#e6db74>&#39;users&#39;</span>]
      <span style=color:#66d9ef>home</span>: /home/john
      <span style=color:#66d9ef>password</span>: $<span style=color:#ae81ff>1</span>$SomeSalt$/jbIwfYCu0MxPBND2EtRH. <span style=color:#75715e>#password</span>


    - <span style=color:#66d9ef>username</span>: cassandra
      <span style=color:#66d9ef>groups</span>: [<span style=color:#e6db74>&#39;users&#39;</span>]
      <span style=color:#66d9ef>home</span>: /home/cassandra
      <span style=color:#66d9ef>password</span>: $<span style=color:#ae81ff>1</span>$SomeSalt$/jbIwfYCu0MxPBND2EtRH. <span style=color:#75715e>#password</span>


    - <span style=color:#66d9ef>username</span>: developerguest1
      <span style=color:#66d9ef>group</span>: users
      <span style=color:#66d9ef>groups</span>: [<span style=color:#e6db74>&#39;developers&#39;</span>]
      <span style=color:#66d9ef>home</span>: /var/www/developers
      <span style=color:#66d9ef>password</span>: $<span style=color:#ae81ff>1</span>$SomeSalt$/jbIwfYCu0MxPBND2EtRH. <span style=color:#75715e>#password</span>
      <span style=color:#66d9ef>shell</span>: /bin/<span style=color:#66d9ef>false</span>

    - <span style=color:#66d9ef>username</span>: developerguest2
      <span style=color:#66d9ef>group</span>: users
      <span style=color:#66d9ef>groups</span>: [<span style=color:#e6db74>&#39;developers&#39;</span>]
      <span style=color:#66d9ef>home</span>: /var/www/developers
      <span style=color:#66d9ef>password</span>: $<span style=color:#ae81ff>1</span>$SomeSalt$/jbIwfYCu0MxPBND2EtRH. <span style=color:#75715e>#password</span>
      <span style=color:#66d9ef>shell</span>: /bin/<span style=color:#66d9ef>false</span>
</code></pre></div><p>So, Ansible will create four users: two common users called John and Cassandra and two developers which won&rsquo;t be able to log into our server using ssh.
The password for all users is &ldquo;password&rdquo;.</p><p>Let&rsquo;s configure our server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ansible-playbook playbooks/setup_test_mine/setup.yml
</code></pre></div><p>After deploying our configurations let&rsquo;s enter inside our vagrant machine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd Sysadmin-Scripts/Vagrant/Ubuntu_14
vagrant ssh
</code></pre></div><p>We will start copying our testing websites in our test machine.
The script <strong>configure.sh</strong> also changes the apache2 conf allowing access on <strong>/var/developers</strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo su
cd
git clone https://github.com/a-castellano/acl-post-websites.git
cd acl-post-websites
./configure.sh
ls /var/developers
developerguest1_website  developerguest2_website  developers_website
</code></pre></div><p>Now we are going to jail the <em>developers</em> users inside <strong>/var/www/developers</strong>.
In order to do this we have to modify our ssh server config, edit <strong>/etc/ssh/sshd_config</strong>, modify this file as follows:</p><pre><code>Port 22
Protocol 2

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_dsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key
UsePrivilegeSeparation yes

KeyRegenerationInterval 3600
ServerKeyBits 1024

SyslogFacility AUTH
LogLevel INFO

LoginGraceTime 120
PermitRootLogin without-password
StrictModes yes

RSAAuthentication yes
PubkeyAuthentication yes

IgnoreRhosts yes

RhostsRSAAuthentication no

HostbasedAuthentication no

PermitEmptyPasswords no

ChallengeResponseAuthentication no

PasswordAuthentication yes

X11Forwarding yes
X11DisplayOffset 10
PrintMotd no
PrintLastLog yes
TCPKeepAlive yes

AcceptEnv LANG LC_*

#Subsystem sftp /usr/lib/openssh/sftp-server
Subsystem sftp internal-sftp
UsePAM yes
Match group developers
    ChrootDirectory /var/developers
    ForceCommand internal-sftp
    AllowTCPForwarding no
    X11Forwarding no
</code></pre><p>Restart the ssh server.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>service ssh restart
</code></pre></div><p>And change the jailed folder ownership and permissions.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>chown root:root /var/developers
chmod go-w /var/developers
</code></pre></div><p>In <strong>/etc/apache2/apache2.conf</strong> we need to add the <strong>/var/developers</strong> folder for giving apache2 access to this folder.</p><h2 id=testing-the-jail>Testing the jail</h2><p><img src=/images/restrict-users-restricted.png alt="developerguest1 is jailed inside /var/developers"></p><p>We did it!
<strong>developerguest1</strong> and <strong>developerguest2</strong> are jailed inside <strong>/var/developers</strong> and they can&rsquo;t go outside this folder.
The problem is solved.</p><h2 id=going-beyond-using-acl>Going beyond, using ACL</h2><p>Finally let&rsquo;s suppose that now we want to block <strong>developerguest1</strong> from accessing <strong>developerguest2_website</strong> folder.
Of course we could create a jailed folder for each user to resolve this issue but in this case we are going tu use <strong>Linux ACL</strong>.</p><p>Access Control List (ACL) provides an additional, more flexible permission mechanism for file systems.
It is designed to assist with UNIX file permissions.
ACL allows you to give permissions for any user or group to any disk resource.</p><p>So, what are we going to do?</p><p>We will change the ownership of <strong>/var/developers</strong> sub folders to <strong>www-data</strong>, the permission will be 770 therefore our developers won&rsquo;t be able to look into their own folders.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd /var/developers
chown -R www-data. developerguest1_website  developerguest2_website  developers_website
chmod -R <span style=color:#ae81ff>770</span> developerguest1_website  developerguest2_website  developers_website
</code></pre></div><p>After doing this the developers can&rsquo;t access to their own directories.</p><p><img src=/images/acl-developer-has-no-permissions.png alt="Developers have no access"></p><p>Using ACL we are going to give developerguest1 permissions to work inside developerguest1_website and developers_website folders.
We will do the same for developerguest2.</p><p><strong>Enabling ACL</strong></p><p>By default, ACL is enabled in Ubuntu14 but we need to enable it in our disk partition.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>vim /etc/fstab
</code></pre></div><p>We need to modify our disk partition settings from this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>LABEL<span style=color:#f92672>=</span>cloudimg-rootfs   /        ext4   defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</code></pre></div><p>To this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>LABEL<span style=color:#f92672>=</span>cloudimg-rootfs   /        ext4   defaults,acl    <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
</code></pre></div><p>We must <strong>reboot</strong> our vagrant machine.</p><p>Let&rsquo;s review which commands we are going to use:
<strong>getfacl</strong>: to review permissions.
<strong>setfacl</strong>: the acl version of chmod.</p><p>Let&rsquo;s go <strong>/var/developers</strong> and give <strong>developerguest1</strong> rights to /var/developers/developerguest1_website</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd /var/developers
getfacl /var/developers/developerguest1_website

<span style=color:#75715e># file: /var/developers/developerguest1_website</span>
<span style=color:#75715e># owner: www-data</span>
<span style=color:#75715e># group: www-data</span>
user::rwx
group::rwx
other::---
</code></pre></div><p>By default, the folder is owned by www-data as we set before.
Using ACL&rsquo;s we are going to configure a new file creation behaviour, for each new file created by our developers, it will have read and execution permission by default.
We do this because if devloperguest1 creates a file, www-data won&rsquo;t be able to read it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -R -d -m  g::rwx /var/developers/developerguest1_website
setfacl -R -d -m  o::rx /var/developers/developerguest1_website
getfacl /var/developers/developerguest1_website

<span style=color:#75715e># file: /var/developers/developerguest1_website</span>
<span style=color:#75715e># owner: www-data</span>
<span style=color:#75715e># group: www-data</span>
user::rwx
group::rwx
other::---
default:user::rwx
default:group::rwx
default:other::r-x
</code></pre></div><p>Wait, what are these <strong>setfacl</strong> options? Let&rsquo;s see them:
<strong>-R</strong>: recurse into subdirectories
<strong>-d</strong>: operations apply to the default ACL
<strong>-m</strong>: modify the current ACL(s) of file(s)</p><p>Let&rsquo;s give <strong>developerguest1</strong> permissions in his folder.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -Rm u:developerguest1:rwx /var/developers/developerguest1_website
getfacl /var/developers/developerguest1_website

<span style=color:#75715e># file: /var/developers/developerguest1_website</span>
<span style=color:#75715e># owner: www-data</span>
<span style=color:#75715e># group: www-data</span>
user::rwx
user:developerguest1:rwx
group::rwx
mask::rwx
other::---
default:user::rwx
default:group::rwx
default:other::r-x
</code></pre></div><p>Now <strong>developerguest1</strong> is able to access to access to <strong>developerguest1_website</strong> and modify it.</p><p><img src=/images/acl-developerguest1-has-access.png alt="Now, developerguest1 has access"></p><p>So, <strong>developerguest1</strong> can change and create files that <strong>www-data</strong> can read, make some tests.</p><p>Let&rsquo;s do the same with <strong>developerguest2</strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -R -d -m  g::rwx /var/developers/developerguest2_website
setfacl -R -d -m  o::rx /var/developers/developerguest2_website
setfacl -Rm u:developerguest2:rwx /var/developers/developerguest2_website
getfacl /var/developers/developerguest2_website

<span style=color:#75715e># file: /var/developers/developerguest2_website</span>
<span style=color:#75715e># owner: www-data</span>
<span style=color:#75715e># group: www-data</span>
user::rwx
user:developerguest2:rwx
group::rwx
mask::rwx
other::---
default:user::rwx
default:group::rwx
default:other::r-x
</code></pre></div><p>Finally, we can assign access to developers group on <strong>developers_website</strong>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -R -d -m  g::rwx /var/developers/developers_website
setfacl -R -d -m  o::rwx /var/developers/developers_website
setfacl -Rm u:developerguest1:rwx /var/developers/developers_website
setfacl -Rm u:developerguest2:rwx /var/developers/developers_website
getfacl /var/developers/developers_website

<span style=color:#75715e># file: /var/developers/developers_website</span>
<span style=color:#75715e># owner: www-data</span>
<span style=color:#75715e># group: www-data</span>
user::rwx
user:developerguest1:rwx
user:developerguest2:rwx
group::rwx
mask::rwx
other::---
default:user::rwx
default:group::rwx
default:other::rwx
</code></pre></div><p>So for any guest developer we create we will need to modify the ACL, isn&rsquo;t?
Well, it is not necessary, we can use ACL&rsquo;s with groups too.</p><p>First, let&rsquo;s delete the current rules over <strong>developers_website</strong>.
We are going to use <strong>-b</strong> option to delete all ACL rules.
There are many other options that we can use, see <a href=https://linux.die.net/man/1/setfacl>setfacl man page</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>setfacl -b /var/developers/developers_website
setfacl -R -d -m  g::rwx /var/developers/developers_website
setfacl -R -d -m  o::rwx /var/developers/developers_website
setfacl -Rm g:developers:rwx /var/developers/developers_website
getfacl /var/developers/developers_website

<span style=color:#75715e># file: var/developers/developers_website</span>
<span style=color:#75715e># owner: www-data</span>
<span style=color:#75715e># group: www-data</span>
user::rwx
group::rwx
group:developers:rwx
mask::rwx
other::---
default:user::rwx
default:group::rwx
default:other::rwx
</code></pre></div><h2 id=conclusion>Conclusion</h2><p>We have learned how to restrict access to some users and manage these access using ACL&rsquo;s.
There are many more things that we can do with ACL&rsquo;s, this is only a silly example.
I hope that you will find this post useful.
Stay tuned for new posts.</p></article></div></div></div></div></main></div></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0"></a></li></ul><a aria-label=Homepage title="Álvaro Castellano - Personal Blog" class="footer-octicon d-none d-lg-block mx-lg-4" href=https://a-castellano.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://a-castellano.github.io/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://a-castellano.github.io/js/github-bootstrap.js></script><script src=https://a-castellano.github.io/js/stop.js></script><script src=https://a-castellano.github.io/js/contributions.js></script></body></html>