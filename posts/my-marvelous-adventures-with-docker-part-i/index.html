<!doctype html><html lang=en-us><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://a-castellano.github.io/css/frameworks.css><link crossorigin=anonymous media=all rel=stylesheet href=https://a-castellano.github.io/css/github.css><link crossorigin=anonymous media="(prefers-color-scheme: dark)" rel=stylesheet href=https://a-castellano.github.io/css/dark.css><meta name=viewport content="width=device-width"><title>My marvelous adventures with Docker - Part I - Álvaro Castellano - Personal Blog</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://a-castellano.github.io/images/favicon.ico><meta name=theme-color content="#1e2327"></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://a-castellano.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://a-castellano.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex"><details class="details-overlay details-reset"><summary class=Header-link aria-label="View profile and more" data-ga-click="Header, show menu, icon:avatar"><img alt class=avatar src="https://avatars0.githubusercontent.com/u/11519707?s=460&u=c9ea059a83c4ea6f9daddec4fff28b1afacbe85a&v=4" height=20 width=20></summary></details></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://a-castellano.github.io/about/><img src="https://avatars0.githubusercontent.com/u/11519707?s=460&u=c9ea059a83c4ea6f9daddec4fff28b1afacbe85a&v=4" width=26 height=26></a>
<span class=author><a href=https://a-castellano.github.io/>Álvaro Castellano</a></span>
<span class=path-divider>/</span>
<strong itemprop=name class=css-truncate-target style=max-width:410px><a href=https://a-castellano.github.io/posts/my-marvelous-adventures-with-docker-part-i/>My marvelous adventures with Docker - Part I</a></strong><div class="d-block text-small text-gray">Created <time-ago datetime=2016-09-05 class=no-wrap title="Created at 2016/09/05">2016-09-05</time-ago>
<span class=file-info-divider></span>Modifyed <time-ago datetime=2016-09-05 class=no-wrap title="Modified  at 2016/09/05">2016-09-05</time-ago></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">954 Words</div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><p><strong>In this post I talk about how to get started in Docker. First we will set a Docker server, afterwards we will create your first Docker image and we will run it.</strong></p><p>Let&rsquo;s play with Docker and learn something about it!</p><p>But wait, what is Docker? <a href=https://www.docker.com>Docker</a> is an open platform to build, ship and run distributed applications anywhere. So you can run apps which &ldquo;live&rdquo; inside a contaniner runned and mannaged by Docker.</p><p>It is very useful when you want to scale your app, the more load, the more containers containing the same app image you will deploy very quickly. It could be like Amazon Auto Scaling Group but you will not deploy full machines.</p><p>The containers run images with your apps, in this post I will create 3 images (I will call them Archons). We will store the docker images into our <a href=https://hub.docker.com>Docker Hub Repo</a>.</p><p><strong>Installing Docker</strong></p><p>I&rsquo;m going to create an 20$/month Ubuntu Droplet in my <a href=https://www.digitalocean.com>Digital Ocean</a> account and I will use <a href=https://www.ansible.com>Ansible</a> to install Docker.</p><p>So, let&rsquo;s clone my <a href=https://github.com/a-castellano/Sysadmin-Scripts.git>Sysadmin Scripts</a> repo and I will use my Docker Role to install all the necesary packages in my droplet.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/a-castellano/Sysadmin-Scripts.git
cd Sysadmin-Scripts/Ansible/
</code></pre></div><p>Place your droplet IP into <em>inventory/my.hosts</em>.</p><pre><code class=language-ansible data-lang=ansible>[Docker]
YOUR_DROPLET_IP
</code></pre><p>If your is Ubuntu version is 16.04 you&rsquo;ll have to install python.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ssh root@YOUR_DROPLET_IP apt-get install -y python
</code></pre></div><p>Launch the playbook and reboot your droplet after the deployment.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ansible-playbook playbooks/setup_docker/setup.yml
</code></pre></div><p><strong>Deploying dockers</strong></p><p>We will start creating our first Archon which will contain an Apache web server. We will create a container from the <a href=https://hub.docker.com/_/debian>official Debian Docker image</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker create  --name ArchonWeb --hostname ArchonWeb -i debian
Unable to find image <span style=color:#e6db74>&#39;debian:latest&#39;</span> locally
latest: Pulling from library/debian

8ad8b3f87b37: Pull complete
Digest: sha256:2340a704d1f8f9ecb51c24d9cbce9f5ecd301b6b8ea1ca5eaba9edee46a2436d
Status: Downloaded newer image <span style=color:#66d9ef>for</span> debian:latest
584c54e123ec442b9c17a1645a9057406c67d8c80f72903a377f904ce9ae7269

</code></pre></div><p>Docker checks if there exists an image called &ldquo;debian&rdquo; in <a href=https://hub.docker.com>Docker Hub</a>. If Docker doesn&rsquo;t have the latest version it will donwload it. When Docker gets the image it will create the container with debian inside.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
584c54e123ec        debian              <span style=color:#e6db74>&#34;/bin/bash&#34;</span>         <span style=color:#ae81ff>2</span> minutes ago       Created                                 ArchonWeb
</code></pre></div><p>Start the docker</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker start ArchonWeb
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
584c54e123ec        debian              <span style=color:#e6db74>&#34;/bin/bash&#34;</span>         <span style=color:#ae81ff>10</span> minutes ago      Up <span style=color:#ae81ff>6</span> seconds                            ArchonWeb
</code></pre></div><p>Ok, our first docker is alive, let&rsquo;s enter into it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker exec -i -t ArchonWeb  /bin/bash
</code></pre></div><p>Congratulations! We are inside our first Docker container running!</p><p>As ArchonWeb will be a web server we are going to install Apache2.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get upgrade -y <span style=color:#f92672>&amp;&amp;</span> apt-get install apache2 apache2-utils php5 php5-mcrypt php5-mysql php5-cli php5-common php5-json php5-readline php-pear libmcrypt4 libapache2-mod-php5 libmcrypt-dev mcrypt mariadb-client net-tools -y
service apache2 start
</code></pre></div><p>Apache2 is running!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>netstat -punta | grep LISTEN
tcp6       <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> :::80                   :::*                    LISTEN      3488/apache2
</code></pre></div><p>Wait, Apache2 is listening on a private address so we can&rsquo;t connect to this server. Don&rsquo;t start to cry yet, we can solve this issue.</p><p>We are making changes in our machine therefore our first step will be create a new image from &ldquo;debian&rdquo; one.</p><p>Let&rsquo;s exit from our docker.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>exit
</code></pre></div><p>Stop the Docker</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker stop ArchonWeb
</code></pre></div><p>Commit a new image called ArchonWeb from the original debian one.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker commit -m <span style=color:#e6db74>&#34;Creating my first image&#34;</span> ArchonWeb
</code></pre></div><p>Now, we have two images in our machine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
&lt;none&gt;              &lt;none&gt;              YOUR_IMAGE_ID       <span style=color:#ae81ff>57</span> seconds ago      262.4 MB
debian              latest              031143c1c662        <span style=color:#ae81ff>3</span> days ago          125.1 MB
</code></pre></div><p>Ok, this is not beauty and it would be better to have our new image in a repository. Create and account in <a href=https://hub.docker.com>Docker Repo</a> and create a new repo too.</p><p><img src=/images/creating_repo.png alt="Creating the repo"></p><p>Log to your Docker Hub account.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker login
Login with your Docker ID to push and pull images from Docker Hub. If you don<span style=color:#960050;background-color:#1e0010>&#39;</span>t have a Docker ID, head over to https://hub.docker.com to create one.
Username: YOUR_USERNAME
Password: YOUR_PASSWORD
Login Succeeded
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker commit -m <span style=color:#e6db74>&#34;Creating my first image&#34;</span> ArchonWeb YOUR_USERNAME/archonweb
</code></pre></div><p>To probe that all is ok let&rsquo;s delete our container and all the images</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@Docker:~|⇒  docker rm ArchonWeb
ArchonWeb
root@Docker:~|⇒  docker images
REPOSITORY              TAG                 IMAGE ID            CREATED             SIZE
YOUR_USERNAME/archonweb   latest              c739c75c3b8e        <span style=color:#ae81ff>33</span> minutes ago      262.4 MB
&lt;none&gt;                  &lt;none&gt;              ad6d1440ebde        <span style=color:#ae81ff>40</span> minutes ago      262.4 MB
debian                  latest              031143c1c662        <span style=color:#ae81ff>3</span> days ago          125.1 MB
root@Docker:~|⇒  docker rmi c739c75c3b8e ad6d1440ebde 031143c1c662
Untagged: YOUR_USERNAME/archonweb:latest
Untagged: YOUR_USERNAME/archonweb@sha256:8e1e908fe823ef1b746718ebb7564548f4f0ea076faaae733f667fb5946acee7
Deleted: sha256:c739c75c3b8e690427a845ae79206b1e3037fddf604765dc5e0478536161e5bb
Deleted: sha256:ad6d1440ebde55617462269619cd457bfa825d8f307c126d7fbc0ca3201c493f
Deleted: sha256:a6a314f5c1a5da3d06226fe40216731384d3f80fafade48a2b1cef3f07384b96
Untagged: debian:latest
Untagged: debian@sha256:2340a704d1f8f9ecb51c24d9cbce9f5ecd301b6b8ea1ca5eaba9edee46a2436d
Deleted: sha256:031143c1c662878cf5be0099ff759dd219f907a22113eb60241251d29344bb96
Deleted: sha256:9e63c5bce4585dd7038d830a1f1f4e44cb1a1515b00e620ac718e934b484c938
</code></pre></div><p>Now we are going to create a new container with our own image and we will redirect the host port 8080 to our docker 80 port.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker create  --name ArchonWeb --hostname ArchonWeb -p 8080:80 -i YOUR_USERNAME/archonweb
docker start ArchonWeb
</code></pre></div><p>Start the container, enter into it and start the Apache2 web server. Now go to your docker host with port 8080 and you&rsquo;ll see the Apache default page.</p><p><img src=/images/apache2_default_page.png alt="Apache 2 Default Server"></p><p>You can configure the container to launch apache2 when you start the container.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>docker create --name ArchonWeb --hostname ArchonWeb -p 8080:80 -i YOUR_USERNAME/archonweb /usr/sbin/apache2ctl -D FOREGROUND
docker start ArchonWeb
</code></pre></div><p>If you followed all the instructions until here you have ArchonWeb running. Congratulations!</p><p>Probably you are having some questions and concerns such as &ldquo;What happens if we put a private webpage in our container, will it be public if we commit our images? Where is the database for my webapps? No worries, this was a first example of how Docker works. In the following posts of this series I will address all these questions and more. For starters, in the next adventure I will talk about <strong>volumes</strong> and <strong>Docker Composer</strong> (for automatize your dockers deployment).</p></article></div></div></div></div></main></div></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0"></a></li></ul><a aria-label=Homepage title="Álvaro Castellano - Personal Blog" class="footer-octicon d-none d-lg-block mx-lg-4" href=https://a-castellano.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95.0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12.0.0.67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15.0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38A8.013 8.013.0 0016 8c0-4.42-3.58-8-8-8z"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://a-castellano.github.io/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://a-castellano.github.io/js/github-bootstrap.js></script><script src=https://a-castellano.github.io/js/stop.js></script><script src=https://a-castellano.github.io/js/contributions.js></script></body></html>